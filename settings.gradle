/*------------------------------------------------------------------------------
  Plugins DSL block
  https://docs.gradle.org/current/userguide/plugins.html#sec:plugins_block
------------------------------------------------------------------------------*/
plugins {
  // use our own plugin
  id "com.mooltiverse.oss.nyx" version "0.0.2-alpha.13"
}

/*------------------------------------------------------------------------------
  Root project properties
------------------------------------------------------------------------------*/
rootProject.name = 'nyx'

include 'docs'
include 'modules:java'
include 'modules:java:lib'
include 'modules:java:lib:version'
include 'modules:java:lib:services'
include 'modules:java:lib:main'
include 'modules:java:gradle'
// re-enable the Docker module once we have something to build and publish
//include 'modules:docker'

/*------------------------------------------------------------------------------
  Extension configurations
------------------------------------------------------------------------------*/
nyx {
  bump          = 'alpha'   // for the time being just bump the 'alpha' pre-release identifier, until we can inspect commit messages
  //stateFile     = file('build/.nyx-state.json')
  commitMessageConventions {
    enabled = ['conventionalCommits']
    items {
      conventionalCommits {
        expression = '(?m)^(?<type>[a-zA-Z0-9_]+)(!)?(\\((?<scope>[a-z ]+)\\))?:( (?<title>.+))$(?s).*'
        bumpExpressions {
          major = '(?s)(?m)^[a-zA-Z0-9_]+(!|.*^(BREAKING( |-)CHANGE: )).*'
          minor = '(?s)(?m)^feat(?!!|.*^(BREAKING( |-)CHANGE: )).*'
          patch = '(?s)(?m)^fix(?!!|.*^(BREAKING( |-)CHANGE: )).*'
        }
      }
    }
  }
}
